---
title: "Oyster Stacks RAD Test"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Practicing with Stacks
These graphs represent are made following the procedure laid out here: https://www.nature.com/articles/nprot.2017.123#Sec27, in order to assess the parameters for doing a full stacks allignment with a lot of samples.

## Graphs
Data wrangling link for cheat sheet: http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf

```{r graph, echo=FALSE, message=FALSE}
library(tidyverse)
library(knitr)

#Import
snps<-read_csv("r80_loci_perM.csv")
locitotals<-read_csv("r80_loci_totals.csv")
snpspercent <- snps[c(1,3,5,7,9,11,13,15,17,19)] #every other collumn, just the percentages
snpbyper <- tidyr::gather(snpspercent, "M", "percent", 2:10)

#Set the order so that 10+ appears last rather than in alphabetical order
snpbyper$n_snps <- factor(snpbyper$n_snps, levels=c("0","1", "2", "3","4", "5", "6","7", "8", "9","10+"))

library(viridis)
#library(RColorBrewer) 
#display.brewer.all(colorblindFriendly = TRUE)
#scale_fill_brewer(palette = "Dark2")
#https://www.datanovia.com/en/blog/the-a-z-of-rcolorbrewer-palette/

ggplot(snpbyper, aes(fill=M, y=percent, x=n_snps)) +
    geom_bar(position="dodge", stat="identity",colour="black", size = 0.2) + 
  labs(y = "Percentage of loci", x= "Number of SNPs") +
  scale_fill_viridis(discrete = TRUE, option="D")+
  theme_classic()

#Plot the number of total loci per M
ggplot(locitotals, aes(y=n_loci_r80, x=M)) +
  labs(y = "No. of loci shared by 80% or more of samples", x= "Value of M parameter") +
  geom_line()+
  theme_classic()+
  scale_x_continuous(breaks=seq(1,9,1))
```


## Compare these to the graphs used by STACKS creators
Sourced from here:https://www.nature.com/articles/nprot.2017.123/figures/2
![](./Figures/compare_STACKSa.png)
These figures were interpreted as showing that there are only marginal increases to loci by increasing M past 4, and M=4 is sufficient to stabilize the proportions of loci with 1â€“5 SNPs. Therefore they maintained M=4 as their parameter for the rest of the analysis.

Examining my data with the same lens, I think my loci shared increases plateau around 7 or 8. 7 and 8 are consistent with eachother, and generally with the others in % of loci. I think that for the number of loci, I should proceed with M = 8
